{% extends "base.html" %}

{% block title %}View Logs - SkillTracker{% endblock %}

{% block content %}
<div class="logs-page">
    <div class="logs-header">
        <div class="header-left">
            <a href="{{ url_for('dashboard') }}" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
            <h1><i class="fas fa-book"></i> Learning Logs</h1>
            <p class="goal-name">
                <i class="fas fa-bullseye"></i> <strong>{{ goal.goal_name }}</strong>
            </p>
        </div>
        <div class="header-right">
            <a href="{{ url_for('log_entry', goal_id=goal.id) }}" class="btn btn-primary">
                <i class="fas fa-plus-circle"></i> Add New Log
            </a>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="logs-stats">
        <div class="stat-box">
            <i class="fas fa-clock"></i>
            <div>
                <h3 id="totalHours">0</h3>
                <p>Total Hours</p>
            </div>
        </div>
        <div class="stat-box">
            <i class="fas fa-calendar-check"></i>
            <div>
                <h3>{{ logs|length }}</h3>
                <p>Log Entries</p>
            </div>
        </div>
        <div class="stat-box">
            <i class="fas fa-fire"></i>
            <div>
                <h3 id="avgHours">0</h3>
                <p>Avg Hours/Day</p>
            </div>
        </div>
        <div class="stat-box">
            <i class="fas fa-calendar-alt"></i>
            <div>
                <h3 id="lastLogged">Never</h3>
                <p>Last Logged</p>
            </div>
        </div>
    </div>

    <!-- Logs List -->
    {% if logs %}
        <div class="logs-container">
            <div class="logs-list">
                {% for log in logs %}
                <div class="log-card">
                    <div class="log-date">
                        <div class="date-circle">
                            <span class="day">{{ log.date.split('-')[2] if log.date else '00' }}</span>
                            <span class="month">{{ ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][log.date.split('-')[1]|int - 1] if log.date else 'N/A' }}</span>
                        </div>
                    </div>
                    
                    <div class="log-content">
                        <div class="log-header">
                            <div class="log-info">
                                <span class="log-hours">
                                    <i class="fas fa-clock"></i>
                                    {{ log.hours_spent }} {{ 'hour' if log.hours_spent == 1 else 'hours' }}
                                </span>
                                <span class="log-date-full">
                                    <i class="fas fa-calendar"></i>
                                    {{ log.date }}
                                </span>
                            </div>
                        </div>
                        
                        {% if log.notes %}
                        <div class="log-notes">
                            <p>{{ log.notes }}</p>
                        </div>
                        {% else %}
                        <div class="log-notes empty">
                            <p><em>No notes recorded for this session</em></p>
                        </div>
                        {% endif %}
                    </div>

                    <div class="log-actions">
                        <a href="{{ url_for('edit_log', log_id=log.id) }}" class="btn-icon" title="Edit log">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{{ url_for('delete_log', log_id=log.id, goal_id=goal.id) }}" 
                           class="btn-icon delete" 
                           title="Delete log"
                           onclick="return confirm('Are you sure you want to delete this log entry? This cannot be undone.')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="empty-state">
            <i class="fas fa-clipboard"></i>
            <h3>No Logs Yet</h3>
            <p>Start tracking your progress by adding your first log entry!</p>
            <a href="{{ url_for('log_entry', goal_id=goal.id) }}" class="btn btn-primary">
                <i class="fas fa-plus-circle"></i> Add First Log
            </a>
        </div>
    {% endif %}

    <!-- Timeline View (Alternative visualization) -->
    {% if logs %}
    <div class="timeline-section">
        <h2><i class="fas fa-stream"></i> Progress Timeline</h2>
        <div class="timeline">
            {% for log in logs %}
            <div class="timeline-item">
                <div class="timeline-marker"></div>
                <div class="timeline-content">
                    <div class="timeline-date">{{ log.date }}</div>
                    <div class="timeline-hours">{{ log.hours_spent }}h</div>
                    {% if log.notes %}
                    <div class="timeline-note">{{ log.notes[:100] }}{{ '...' if log.notes|length > 100 }}</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<script>
const logs = {{ logs|tojson }};

// Calculate total hours
let totalHours = 0;
logs.forEach(log => {
    totalHours += parseFloat(log.hours_spent);
});
document.getElementById('totalHours').textContent = totalHours.toFixed(1);

// Calculate average hours per day
const avgHours = logs.length > 0 ? (totalHours / logs.length).toFixed(1) : 0;
document.getElementById('avgHours').textContent = avgHours;

// Show last logged date
if (logs.length > 0) {
    const lastDate = logs[0].date;
    const date = new Date(lastDate + 'T00:00:00');
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    date.setHours(0, 0, 0, 0);
    const diffTime = Math.abs(today - date);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 0) {
        document.getElementById('lastLogged').textContent = 'Today';
    } else if (diffDays === 1) {
        document.getElementById('lastLogged').textContent = 'Yesterday';
    } else {
        document.getElementById('lastLogged').textContent = diffDays + ' days ago';
    }
}
</script>
{% endblock %}